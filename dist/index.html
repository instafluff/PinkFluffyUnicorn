<html>
  <head>
    <title>Pink Fluffy Unicorn Game Engine</title>
    <link href="https://fonts.googleapis.com/css?family=Bubblegum+Sans" rel="stylesheet">
    <link rel='stylesheet' href='unicorn.css' />
    <script src="pinkfluffyunicorn.min.js"></script>
  </head>
  <body>
    <div id="unicorn-display"></div>
    <script>
      var counter = 0;
      function launchTacos() {
        counter++;
        switch( Math.floor( 8 * Math.random() ) ) {
          case 0:
            Unicorn.AddParticles( "Confetti" + counter, {
              blendMode: PIXI.BLEND_MODES.NORMAL,
              shape: "line", // "cone", "line"
              // lineDirection: 0,
              // length: 400,
              startColor: "#ffffff",
              endColor: "#ffffff",
              angle: Math.PI / 2 + Math.PI / 10,
              intensity: 0.75, // Scale from 1 - 10
              minSpeed: 0.25,
              maxSpeed: 0.5,
              decay: 10, // Scale from 0 - 10
              image: "assets/tacoParticle.png",
            }, 0, -50);
            break;
          case 1:
            Unicorn.AddParticles( "Confetti" + counter, {
              blendMode: PIXI.BLEND_MODES.NORMAL,
              shape: "line", // "cone", "line"
              // lineDirection: 0,
              // length: 400,
              startColor: "#ffffff",
              endColor: "#ffffff",
              angle: Math.PI / 2 - Math.PI / 10,
              intensity: 0.75, // Scale from 1 - 10
              minSpeed: 0.25,
              maxSpeed: 0.5,
              decay: 10, // Scale from 0 - 10
              image: "assets/tacoParticle.png",
            }, 0, -70);
            break;
          case 2:
            Unicorn.AddParticles( "Confetti" + counter, {
              blendMode: PIXI.BLEND_MODES.NORMAL,
              shape: "line", // "cone", "line"
              // lineDirection: 0,
              // length: 400,
              startColor: "#ffffff",
              endColor: "#ffffff",
              angle: Math.PI / 2 + Math.PI / 5,
              intensity: 0.75, // Scale from 1 - 10
              minSpeed: 0.25,
              maxSpeed: 0.5,
              decay: 10, // Scale from 0 - 10
              image: "assets/tacoParticle.png",
            }, 0, -59);
            break;
          case 3:
            Unicorn.AddParticles( "Confetti" + counter, {
              blendMode: PIXI.BLEND_MODES.NORMAL,
              shape: "line", // "cone", "line"
              // lineDirection: 0,
              // length: 400,
              startColor: "#ffffff",
              endColor: "#ffffff",
              angle: Math.PI / 2,
              intensity: 0.75, // Scale from 1 - 10
              minSpeed: 0.25,
              maxSpeed: 0.5,
              decay: 10, // Scale from 0 - 10
              image: "assets/tacoParticle.png",
            }, 0, -100);
            break;
          case 4:
            Unicorn.AddParticles( "Confetti" + counter, {
              blendMode: PIXI.BLEND_MODES.NORMAL,
              shape: "line", // "cone", "line"
              // lineDirection: 0,
              // length: 400,
              startColor: "#ffffff",
              endColor: "#ffffff",
              angle: Math.PI / 2 + Math.PI / 10,
              intensity: 0.75, // Scale from 1 - 10
              minSpeed: 0.25,
              maxSpeed: 0.5,
              decay: 10, // Scale from 0 - 10
              image: "assets/tacoParticle.png",
            }, 0, -50);
            break;
          case 5:
            Unicorn.AddParticles( "Confetti" + counter, {
              blendMode: PIXI.BLEND_MODES.NORMAL,
              shape: "line", // "cone", "line"
              // lineDirection: 0,
              // length: 400,
              startColor: "#ffffff",
              endColor: "#ffffff",
              angle: Math.PI / 2 - Math.PI / 10,
              intensity: 0.75, // Scale from 1 - 10
              minSpeed: 0.25,
              maxSpeed: 0.5,
              decay: 10, // Scale from 0 - 10
              image: "assets/tacoParticle.png",
            }, 0, -70);
            break;
          case 6:
            Unicorn.AddParticles( "Confetti" + counter, {
              blendMode: PIXI.BLEND_MODES.NORMAL,
              shape: "line", // "cone", "line"
              // lineDirection: 0,
              // length: 400,
              startColor: "#ffffff",
              endColor: "#ffffff",
              angle: Math.PI / 2 + Math.PI / 5,
              intensity: 0.75, // Scale from 1 - 10
              minSpeed: 0.25,
              maxSpeed: 0.5,
              decay: 10, // Scale from 0 - 10
              image: "assets/tacoParticle.png",
            }, 0, -59);
            break;
          case 7:
            Unicorn.AddParticles( "Confetti" + counter, {
              blendMode: PIXI.BLEND_MODES.NORMAL,
              shape: "line", // "cone", "line"
              // lineDirection: 0,
              // length: 400,
              startColor: "#ffffff",
              endColor: "#ffffff",
              angle: Math.PI / 2,
              intensity: 0.75, // Scale from 1 - 10
              minSpeed: 0.25,
              maxSpeed: 0.5,
              decay: 10, // Scale from 0 - 10
              image: "assets/tacoParticle.png",
            }, 0, -100);
            break;
        }
        stopConfetti( "Confetti" + counter );
      }

      function launchConfetti( imageOverride = "" ) {
        counter++;
        switch( Math.floor( 8 * Math.random() ) ) {
          case 0:
            Unicorn.AddParticles( "Confetti" + counter, {
              blendMode: PIXI.BLEND_MODES.DEFAULT,
              shape: "line", // "cone", "line"
              // lineDirection: 0,
              // length: 400,
              angle: Math.PI / 2 + Math.PI / 10,
              startColor: "#ff0000",
              endColor: "#FB8200",
              intensity: 0.75, // Scale from 1 - 10
              minSpeed: 0.05,
              maxSpeed: 0.5,
              decay: 10, // Scale from 0 - 10
              image: imageOverride || "assets/confetti.png",
            }, 0, -50);
            break;
          case 1:
            Unicorn.AddParticles( "Confetti" + counter, {
              blendMode: PIXI.BLEND_MODES.DEFAULT,
              shape: "line", // "cone", "line"
              // lineDirection: 0,
              // length: 400,
              angle: Math.PI / 2 - Math.PI / 10,
              startColor: "#00ff00",
              endColor: "#FB8200",
              intensity: 0.75, // Scale from 1 - 10
              minSpeed: 0.05,
              maxSpeed: 0.5,
              decay: 10, // Scale from 0 - 10
              image: imageOverride || "assets/confetti4.png",
            }, 0, -70);
            break;
          case 2:
            Unicorn.AddParticles( "Confetti" + counter, {
              blendMode: PIXI.BLEND_MODES.DEFAULT,
              shape: "line", // "cone", "line"
              // lineDirection: 0,
              // length: 400,
              angle: Math.PI / 2 + Math.PI / 5,
              startColor: "#ffff00",
              endColor: "#FB8200",
              intensity: 0.75, // Scale from 1 - 10
              minSpeed: 0.05,
              maxSpeed: 0.5,
              decay: 10, // Scale from 0 - 10
              image: imageOverride || "assets/confetti3.png",
            }, 0, -59);
            break;
          case 3:
            Unicorn.AddParticles( "Confetti" + counter, {
              blendMode: PIXI.BLEND_MODES.DEFAULT,
              shape: "line", // "cone", "line"
              // lineDirection: 0,
              // length: 400,
              angle: Math.PI / 2,
              startColor: "#0000ff",
              endColor: "#FB8200",
              intensity: 0.75, // Scale from 1 - 10
              minSpeed: 0.05,
              maxSpeed: 0.5,
              decay: 10, // Scale from 0 - 10
              image: imageOverride || "assets/confetti2.png",
            }, 0, -100);
            break;
          case 4:
            Unicorn.AddParticles( "Confetti" + counter, {
              blendMode: PIXI.BLEND_MODES.DEFAULT,
              shape: "line", // "cone", "line"
              // lineDirection: 0,
              // length: 400,
              angle: Math.PI / 2 + Math.PI / 10,
              startColor: "#ff0000",
              endColor: "#FB8200",
              intensity: 0.75, // Scale from 1 - 10
              minSpeed: 0.05,
              maxSpeed: 0.5,
              decay: 10, // Scale from 0 - 10
              image: imageOverride || "assets/confetti4.png",
            }, 0, -50);
            break;
          case 5:
            Unicorn.AddParticles( "Confetti" + counter, {
              blendMode: PIXI.BLEND_MODES.DEFAULT,
              shape: "line", // "cone", "line"
              // lineDirection: 0,
              // length: 400,
              angle: Math.PI / 2 - Math.PI / 10,
              startColor: "#00ff00",
              endColor: "#FB8200",
              intensity: 0.75, // Scale from 1 - 10
              minSpeed: 0.05,
              maxSpeed: 0.5,
              decay: 10, // Scale from 0 - 10
              image: imageOverride || "assets/confetti1.png",
            }, 0, -70);
            break;
          case 6:
            Unicorn.AddParticles( "Confetti" + counter, {
              blendMode: PIXI.BLEND_MODES.DEFAULT,
              shape: "line", // "cone", "line"
              // lineDirection: 0,
              // length: 400,
              angle: Math.PI / 2 + Math.PI / 5,
              startColor: "#ffff00",
              endColor: "#FB8200",
              intensity: 0.75, // Scale from 1 - 10
              minSpeed: 0.05,
              maxSpeed: 0.5,
              decay: 10, // Scale from 0 - 10
              image: imageOverride || "assets/confetti.png",
            }, 0, -59);
            break;
          case 7:
            Unicorn.AddParticles( "Confetti" + counter, {
              blendMode: PIXI.BLEND_MODES.DEFAULT,
              shape: "line", // "cone", "line"
              // lineDirection: 0,
              // length: 400,
              angle: Math.PI / 2,
              startColor: "#0000ff",
              endColor: "#FB8200",
              intensity: 0.75, // Scale from 1 - 10
              minSpeed: 0.05,
              maxSpeed: 0.5,
              decay: 10, // Scale from 0 - 10
              image: imageOverride || "assets/confetti3.png",
            }, 0, -100);
            break;
        }
        stopConfetti( "Confetti" + counter );
      }

      function stopConfetti( name ) {
        setTimeout( () => {
          Unicorn.RemoveParticles( name );
        }, 2000 );
      }

      function Init() {
        // Add Initialization Here
        Unicorn.Load( "fart", "assets/fart-2.wav" );
        Unicorn.Load( "yay", "assets/yay.mp3" );
        Unicorn.Load( "unicorn", "assets/Unicorn.png" );
        Unicorn.Load( "ball", "assets/Ball.png" );
        // Unicorn.Load( "hamster", "assets/rainbowHammie.png" );
        // Unicorn.AddOverlay( "icon", "unicorn", 100, 100 );
        // Unicorn.AddText( "title", "Pink Fluffy Unicorn Game Engine", 50, 50, {
        //   fontFamily: 'Bubblegum Sans',
        //   fontSize: 36,
        //   fontWeight: 'bold',
        //   fill: "#ffffff"
        // });
        // Unicorn.AddObject( "box", {
        //   type: "rectangle",
        //   x: 64, y: 300,
        //   width: 128, height: 128,
        //   // sprite: "unicorn",
        //   // bounce: 3,
        //   isStatic: true
        // } );
        // Unicorn.AddDetector( "detect", {
        //   type: "rectangle",
        //   x: 64, y: 300,
        //   width: 128, height: 128
        // }, ( label, body ) => {
        //   console.log( "Enter:", label, body );
        //   Unicorn.PlaySound( "fart", {
        //     volume: 0.25
        //   } );
        // }, ( label, body ) => {
        //   console.log( "Exit:", label, body );
        // } );
        // Unicorn.AddObject( "ball1", {
        //   type: "circle",
        //   x: 64, y: 64,
        //   radius: 64,
        //   sprite: "ball",
        //   friction: 0.01,
        //   onHover: function() {
        //     this.alpha = 0.5;
        //   },
        //   onLeave: function() {
        //     this.alpha = 1;
        //   }
        // } );
        // Unicorn.AddObject( "ball2", {
        //   type: "circle",
        //   x: 256, y: 64,
        //   radius: 64,
        //   // sprite: "ball",
        //   friction: 0.02
        // } );
        // Unicorn.ConnectObjects( "ball1", "ball2", {
        //   length: 192,
        //   damping: 0.5,
        //   stiffness: 0.2
        // } );
        // Unicorn.ConnectObjects( "", "ball2", {
        //   damping: 0.5,
        //   stiffness: 0.2
        // }, { x: 300, y: 0 } );
        // Unicorn.AddParticles( "WIND", {
        //   blendMode: PIXI.BLEND_MODES.MULTIPLY,
        //   shape: "line", // "cone", "line"
        //   lineDirection: Math.PI / 2,
        //   // length: 400,
        //   angle: 0,
        //   startColor: "#333333",
        //   endColor: "#000000",
        //   intensity: 20, // Scale from 1 - 10
        //   minSpeed: 0.1,
        //   maxSpeed: 2.25,
        //   decay: 0.5, // Scale from 0 - 10
        // }, -100, 0);

        // Unicorn.AddParticles( "windysnow", {
        //   blendMode: PIXI.BLEND_MODES.DEFAULT,
        //   shape: "line", // "cone", "line"
        //   // lineDirection: 0,
        //   length: 1920,
        //   angle: Math.PI / 4,
        //   // startColor: "#88ff00",
        //   // endColor: "#ff0088",
        //   startColor: "#ffffff",
        //   endColor: "#ffffff",
        //   intensity: 5, // Scale from 1 - 10
        //   minSpeed: 0.1,
        //   maxSpeed: 1.25,
        //   decay: 5, // Scale from 0 - 10
        // }, -640, 0);
        // Unicorn.AddParticles( "ROOFISONFIRE", {
        //   blendMode: PIXI.BLEND_MODES.DEFAULT,
        //   shape: "line", // "cone", "line"
        //   // lineDirection: 0,
        //   // length: 400,
        //   angle: Math.PI / 2,
        //   startColor: "#ff0000",
        //   endColor: "#FB8200",
        //   intensity: 10000, // Scale from 1 - 10
        //   minSpeed: 0.1,
        //   maxSpeed: 0.25,
        //   decay: 2, // Scale from 0 - 10
        // }, 0, 0);
        // Unicorn.AddParticles( "FIRE", {
        //   blendMode: PIXI.BLEND_MODES.DEFAULT,
        //   shape: "line", // "cone", "line"
        //   // lineDirection: 0,
        //   // length: 400,
        //   angle: -Math.PI / 2,
        //   startColor: "#ff0000",
        //   endColor: "#FB8200",
        //   intensity: 10000, // Scale from 1 - 10
        //   minSpeed: 0.1,
        //   maxSpeed: 0.25,
        //   decay: 2, // Scale from 0 - 10
        // }, 0, 720);
        // Unicorn.AddParticles( "snow", {
        //   blendMode: PIXI.BLEND_MODES.DEFAULT,
        //   shape: "line", // "cone", "line"
        //   // lineDirection: 0,
        //   // length: 400,
        //   angle: Math.PI / 2,
        //   // startColor: "#88ff00",
        //   // endColor: "#ff0088",
        //   startColor: "#ffffff",
        //   endColor: "#ffffff",
        //   intensity: 4, // Scale from 1 - 10
        //   minSpeed: 0.1,
        //   maxSpeed: 1.25,
        //   decay: 5, // Scale from 0 - 10
        // }, 0, 0);
        // Unicorn.AddParticles( "rain", {
        //   blendMode: PIXI.BLEND_MODES.OVERLAY,
        //   shape: "line", // "cone", "line"
        //   // lineDirection: 0,
        //   // length: 400,
        //   image: "assets/rainbowHammie.png",
        //   angle: Math.PI / 2,
        //   // startColor: "#88ff00",
        //   // endColor: "#ff0088",
        //   startColor: "#ffffff",
        //   endColor: "#ffffff",
        //   intensity: 1, // Scale from 1 - 10
        //   minSpeed: 0.1,
        //   maxSpeed: 0.25,
        //   decay: 10, // Scale from 0 - 10
        // }, 0, 0);
        // Unicorn.AddParticles( "blastoff", {
        //   shape: "cone", // "cone", "line"
        //   angle: Math.PI / 2,
        //   spread: Math.PI / 2,
        //   // startColor: "#88ff00",
        //   endColor: "#ff0088",
        //   startColor: "#FB8200",
        //   // endColor: "#FEBE79",
        //   intensity: 50, // Scale from 1 - 10
        //   minSpeed: 0.1,
        //   maxSpeed: 0.25,
        //   decay: 1, // Scale from 0 - 10
        // }, 600, 100);
        // Unicorn.AddParticles( "fireworks", {
        //   shape: "circle", // "cone", "line"
        //   // startColor: "#88ff00",
        //   // endColor: "#ff0088",
        //   startColor: "#FB8200",
        //   endColor: "#FEBE79",
        //   intensity: 10, // Scale from 1 - 10
        //   minSpeed: 0.1,
        //   maxSpeed: 0.25,
        //   decay: 1, // Scale from 0 - 10
        // }, 100, 100);
        // Unicorn.AddTimer( "boom", 5000, () => {
        //   Unicorn.SetVelocity( "ball1", 50, -10 );
        //   Unicorn.ResetTimer( "boom", 2000 );
        // } )
      }

      function Update( timestamp, timeDiffInMs ) {
        // Add Update Loop
        // console.log( timestamp, timeDiffInMs );
        if( timestamp > 5000 ) {
          Unicorn.RemoveOverlay( "icon" );
        }
      }

      function OnChatCommand( user, command, message, flags, extra ) {
        // Handle Chat Commands
        if( flags.broadcaster && command == "test" ) {
          console.log( "!test was typed in chat" );
        }
        if( flags.broadcaster && command == "disconnect" ) {
          Unicorn.DisconnectObjects( "", "ball2" );
        }
        if( extra.customRewardId === "24769436-b87c-4370-ab32-e475bebea7a3" ) {
          for( var i = 0; i < 50; i++ ) {
            launchConfetti();
          }
          setTimeout( () => {
            Unicorn.PlaySound( "yay", {
              volume: 0.25
            } );
          }, 1000 );
        }
        if( command === "tacos" ) {
          for( var i = 0; i < 8; i++ ) {
            launchTacos();
          }
        }
        if( command === "confetti" ||
            command === "party" ||
            command === "birthday" ||
            command === "celebrate" ||
            command === "yay" ) {
          for( var i = 0; i < 8; i++ ) {
            launchConfetti();
          }
          // setTimeout( () => {
          //   Unicorn.PlaySound( "yay", {
          //     volume: 0.25
          //   } );
          //   // stopConfetti();
          // }, 1000 );
        }
        if( command === "boom" ) {
          Unicorn.SetVelocity( "ball1", -50, -10 );
        }
        if( command === "ball" ) {
          Unicorn.AddObject( "bam" + counter++, {
            type: "circle",
            x: 128, y: 64,
            radius: 64,
            sprite: "ball",
            friction: 0.02
          } );
        }
        if( command === "balls" ) {
          for( var i = 0; i < 5; i++ ) {
            Unicorn.AddObject( "bam" + counter++, {
              type: "circle",
              x: 128, y: 64,
              radius: 64,
              sprite: "ball",
              friction: 0.02
            } );
          }
        }
      }

      function OnChatMessage( user, message, flags, self, extra ) {
        // Handle Chat Messages
        if( extra.customRewardId === "24769436-b87c-4370-ab32-e475bebea7a3" ) {
          for( var i = 0; i < 50; i++ ) {
            launchConfetti();
          }
          setTimeout( () => {
            Unicorn.PlaySound( "yay", {
              volume: 0.25
            } );
          }, 1000 );
        }
      }

      window.addEventListener('load', () => {
        Unicorn.Create( "unicorn-display", {
          width: 1280,
          height: 720,
          // background: "#000000",// "transparent",
          background: "transparent",
          init: Init,
          update: Update,
          channel: "Instafluff",
          onCommand: OnChatCommand,
          onChat: OnChatMessage,
          // screenWalls: false // Default: true
          // gravity: { x: 0, y: 0.5 } // Default: { x: 0, y: 1 }
        });
      });
    </script>
  </body>
</html>
